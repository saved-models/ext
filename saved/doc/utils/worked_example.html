<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>worked_example – SAVED project documentation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../doc/utils/debugging.html" rel="next">
<link href="../../doc/utils/manifest.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": true,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link rel="stylesheet" href="../../assets/fira.css" type="text/css">
<meta name="quarto:status" content="draft">


<meta property="og:title" content="SAVED project documentation">
<meta property="og:site_name" content="SAVED project documentation">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><div id="quarto-draft-alert" class="alert alert-warning"><i class="bi bi-pencil-square"></i>Draft</div>
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Overview</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-project-documentation" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Project documentation</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-project-documentation">    
        <li>
    <a class="dropdown-item" href="../../doc/misc/outline.html">
 <span class="dropdown-text">Project outline</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../doc/utils/index.html">
 <span class="dropdown-text">Fish data utilities</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../schema/index.html"> 
<span class="menu-text">Data model / ontology</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../doc/utils/index.html">Fish data utilities</a></li><li class="breadcrumb-item"><a href="../../doc/utils/worked_example.html">A worked example</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../doc/misc/outline.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Project outline</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Fish data utilities</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../doc/utils/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Fish data utilities overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../doc/utils/schemata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">YAML schema writing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../doc/utils/manifest.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The manifest</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../doc/utils/worked_example.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">A worked example</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../doc/utils/debugging.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Debugging and troubleshooting</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#a-worked-example" id="toc-a-worked-example" class="nav-link active" data-scroll-target="#a-worked-example">A worked example</a>
  <ul class="collapse">
  <li><a href="#prerequisites" id="toc-prerequisites" class="nav-link" data-scroll-target="#prerequisites">Prerequisites</a></li>
  <li><a href="#preparing-the-initial-manifest-file-with-fisdat" id="toc-preparing-the-initial-manifest-file-with-fisdat" class="nav-link" data-scroll-target="#preparing-the-initial-manifest-file-with-fisdat">Preparing the initial manifest file with <code>fisdat</code></a></li>
  <li><a href="#editing-the-initial-manifest-file" id="toc-editing-the-initial-manifest-file" class="nav-link" data-scroll-target="#editing-the-initial-manifest-file">Editing the initial manifest file</a>
  <ul class="collapse">
  <li><a href="#titles-and-descriptions" id="toc-titles-and-descriptions" class="nav-link" data-scroll-target="#titles-and-descriptions">Titles and descriptions</a></li>
  </ul></li>
  <li><a href="#specifying-a-job" id="toc-specifying-a-job" class="nav-link" data-scroll-target="#specifying-a-job">Specifying a job</a></li>
  <li><a href="#uploading-the-data-package-with-fisup" id="toc-uploading-the-data-package-with-fisup" class="nav-link" data-scroll-target="#uploading-the-data-package-with-fisup">Uploading the data package with <code>fisup</code></a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/saved-models/data-model/issues/new/choose" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">




<section id="a-worked-example" class="level1">
<h1>A worked example</h1>
<section id="prerequisites" class="level2">
<h2 class="anchored" data-anchor-id="prerequisites">Prerequisites</h2>
<p>In the <a href="https://github.com/wwaites/saved_fisdat/tree/main/examples/density_count_model"><code>examples/density_count_model</code></a> directory, there is a pre-prepared manifest file which uses three cage data totals files, and an example time-series of densities.</p>
</section>
<section id="preparing-the-initial-manifest-file-with-fisdat" class="level2">
<h2 class="anchored" data-anchor-id="preparing-the-initial-manifest-file-with-fisdat">Preparing the initial manifest file with <code>fisdat</code></h2>
<p>Before specifying any job, we need to generate an initial manifest file which we can fill out. This will add the three cage data files as tables, and will also add boilerplate for an example, ignored job.</p>
<p>There are four target data files which we are going to add:</p>
<ol type="1">
<li>The time series of densities. The schema file (<code>density.yaml</code>) is very simple.</li>
<li>Cage data for cage #8, autumn 2011, deployed 26/10 - 01/11. The schema file is identical to the sentinel cages data example.</li>
<li>Cage data for cage #9, autumn 2011, deployed 26/10 - 01/11. Same schema file.</li>
<li>Cage data for cage #10, autumn 2011, deployed 26/10 - 01/11. Same schema file.</li>
</ol>
<p>The target file to work on is going to be called <code>test_manifest.yaml</code>.</p>
<p>Let’s start by adding the density time series to our new manifest file:</p>
<pre><code>fisdat density.yaml density.csv test_manifest.yaml</code></pre>
<p>We should see something not unlike the following:</p>
<pre><code>This is fisdat version 0.7, commit a70efdba00aaff8dce42f0a698b8f1af572a5b3f
Wrote to test_manifest.yaml:
------------------------------------------
| data URI    | data schema  | data hash |
------------------------------------------
| density.csv | density.yaml | 1974c2dbe |
------------------------------------------</code></pre>
<p>Now, let’s add one of the cage data files:</p>
<pre><code>fisdat sentinel_cages_sampling.yaml deployment_2011-10-26_2011-11-01_cage_8.csv test_manifest.yaml</code></pre>
<p>We should now see something as follows:</p>
<pre><code>Wrote to test_manifest.yaml:
------------------------------------------------------------------------------------------
| data URI                                    | data schema                  | data hash |
------------------------------------------------------------------------------------------
| density.csv                                 | density.yaml                 | 1974c2dbe |
| deployment_2011-10-26_2011-11-01_cage_8.csv | sentinel_cages_sampling.yaml | 0b93c10c8 |
------------------------------------------------------------------------------------------</code></pre>
<p>Now, add the other two cage data files to the file. Output should be very similar to the above.</p>
<pre><code>fisdat sentinel_cages_sampling.yaml deployment_2011-10-26_2011-11-01_cage_9.csv test_manifest.yaml
fisdat sentinel_cages_sampling.yaml deployment_2011-10-26_2011-11-01_cage_10.csv test_manifest.yaml</code></pre>
</section>
<section id="editing-the-initial-manifest-file" class="level2">
<h2 class="anchored" data-anchor-id="editing-the-initial-manifest-file">Editing the initial manifest file</h2>
<section id="titles-and-descriptions" class="level3">
<h3 class="anchored" data-anchor-id="titles-and-descriptions">Titles and descriptions</h3>
<p>We should now have a usable manifest file describing the structure of the data package to upload. Let’s have a look at it.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">atomic_name</span><span class="kw">:</span><span class="at"> RootManifest</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tables</span><span class="kw">:</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">atomic_name</span><span class="kw">:</span><span class="at"> density</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">resource_path</span><span class="kw">:</span><span class="at"> density.csv</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">resource_hash</span><span class="kw">:</span><span class="at"> 1974c2dbefaeaaa425a789142e405f7b8074bb96348b24003fe36bf4098e6b58e2227680bcf72634c4553b214f33acb4</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">schema_path_yaml</span><span class="kw">:</span><span class="at"> density.yaml</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">atomic_name</span><span class="kw">:</span><span class="at"> deployment_2011-10-26_2011-11-01_cage_8</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">resource_path</span><span class="kw">:</span><span class="at"> deployment_2011-10-26_2011-11-01_cage_8.csv  </span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">resource_hash</span><span class="kw">:</span><span class="at"> 0b93c10c8de980fe7213040096dcabb4f7c66efe03ea1f479007da6ea2800b0b2e226b854c6f1a0b22c742a9cae0ec99</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">schema_path_yaml</span><span class="kw">:</span><span class="at"> sentinel_cages_sampling.yaml</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">atomic_name</span><span class="kw">:</span><span class="at"> deployment_2011-10-26_2011-11-01_cage_9</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">resource_path</span><span class="kw">:</span><span class="at"> deployment_2011-10-26_2011-11-01_cage_9.csv</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">resource_hash</span><span class="kw">:</span><span class="at"> 89361535458427edda4c59e609553a897b3f1110f1c6d97c9bb43196715c3c48f8d0da1536429eb2b21a0d4f6bbd9f1e</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">schema_path_yaml</span><span class="kw">:</span><span class="at"> sentinel_cages_sampling.yaml</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">atomic_name</span><span class="kw">:</span><span class="at"> deployment_2011-10-26_2011-11-01_cage_10</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">resource_path</span><span class="kw">:</span><span class="at"> deployment_2011-10-26_2011-11-01_cage_10.csv</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">resource_hash</span><span class="kw">:</span><span class="at"> 5b75481628cfaf3206721491c906a95348f7abd32a9c70a82f57821add8169fb7abd174314a669bed9612183345a295f</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">schema_path_yaml</span><span class="kw">:</span><span class="at"> sentinel_cages_sampling.yaml</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">atomic_name</span><span class="kw">:</span><span class="at"> job_example_density</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">job_type</span><span class="kw">:</span><span class="at"> ignore</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">title</span><span class="kw">:</span><span class="at"> Empty job template for density</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="fu">local_version</span><span class="kw">:</span><span class="at"> 0.7+4.ga70efdb.dirty</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>While this would be sufficient for uploading (indeed, the job is just ignored), there are a couple of things to note.</p>
<p>First, the <code>fisdat</code> program knows nothing about the title of data proper (this is distinct from the title of the schema). We might add a title for a given table (although this is not required), something like the following:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">atomic_name</span><span class="kw">:</span><span class="at"> deployment_2011-10-26_2011-11-01_cage_8</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">title</span><span class="kw">:</span><span class="at"> Cage 8, season A11, deployment 1 (2011-10-26 - 2011-11-01)</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">description</span><span class="kw">:</span><span class="at"> Derived from the sentinel cages example</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">resource_path</span><span class="kw">:</span><span class="at"> deployment_2011-10-26_2011-11-01_cage_8.csv</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">resource_hash</span><span class="kw">:</span><span class="at"> 0b93c10c8de980fe7213040096dcabb4f7c66efe03ea1f479007da6ea2800b0b2e226b854c6f1a0b22c742a9cae0ec99</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">schema_path_yaml</span><span class="kw">:</span><span class="at"> sentinel_cages_sampling.yaml</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>After adding this, check that upload using this file would be possible, using the <code>--dry-run</code> option of <code>fisup</code>. This is useful since it won’t make any conversions of schema/manifest to different formats (but will load the file).</p>
<pre><code>fisup --dry-run test_manifest.yaml</code></pre>
<p>We should see something not unlike the following:</p>
<pre><code>This is fisup version 0.7, commit a70efdba00aaff8dce42f0a698b8f1af572a5b3f
Target file test_manifest.converted.ttl doesn't exist, so overwrite
Target file density.converted.ttl exists, and force-overwrite (`--force' option) is set, so overwrite
Would have converted schema from YAML density.yaml to TTL density.converted.ttl
Would have converted schema from YAML sentinel_cages_sampling.yaml to TTL sentinel_cages_sampling.converted.ttl
Would have converted schema from YAML sentinel_cages_sampling.yaml to TTL sentinel_cages_sampling.converted.ttl
Would have converted schema from YAML sentinel_cages_sampling.yaml to TTL sentinel_cages_sampling.converted.ttl
Successfully converted all schemata from YAML to TTL
Would have converted manifest from YAML test_manifest.yaml to TTL test_manifest.converted.ttl
Would have written the following to index file .index:
-----------------------------------------------------------
| test_manifest.yaml                                      |
| test_manifest.converted.ttl                             |
| https://marine.gov.scot/metadata/saved/rap/             |
| https://marine.gov.scot/metadata/saved/rap/RootManifest |
-----------------------------------------------------------
Would upload to gs://saved-fisdat/strathclyde/20240730/22464600-4e62-11ef-ad7c-f218987e77f1/test_manifest.yaml ...
Would upload to gs://saved-fisdat/strathclyde/20240730/22464600-4e62-11ef-ad7c-f218987e77f1/test_manifest.converted.ttl ...
Would upload to gs://saved-fisdat/strathclyde/20240730/22464600-4e62-11ef-ad7c-f218987e77f1/.index ...
Would upload to gs://saved-fisdat/strathclyde/20240730/22464600-4e62-11ef-ad7c-f218987e77f1/density.csv ...
Would upload to gs://saved-fisdat/strathclyde/20240730/22464600-4e62-11ef-ad7c-f218987e77f1/deployment_2011-10-26_2011-11-01_cage_8.csv ...
Would upload to gs://saved-fisdat/strathclyde/20240730/22464600-4e62-11ef-ad7c-f218987e77f1/deployment_2011-10-26_2011-11-01_cage_9.csv ...
Would upload to gs://saved-fisdat/strathclyde/20240730/22464600-4e62-11ef-ad7c-f218987e77f1/deployment_2011-10-26_2011-11-01_cage_10.csv ...
Would upload to gs://saved-fisdat/strathclyde/20240730/22464600-4e62-11ef-ad7c-f218987e77f1/density.yaml ...
Would upload to gs://saved-fisdat/strathclyde/20240730/22464600-4e62-11ef-ad7c-f218987e77f1/sentinel_cages_sampling.yaml ...
Would upload to gs://saved-fisdat/strathclyde/20240730/22464600-4e62-11ef-ad7c-f218987e77f1/sentinel_cages_sampling.yaml ...
Would upload to gs://saved-fisdat/strathclyde/20240730/22464600-4e62-11ef-ad7c-f218987e77f1/sentinel_cages_sampling.yaml ...
Would upload to gs://saved-fisdat/strathclyde/20240730/22464600-4e62-11ef-ad7c-f218987e77f1/density.converted.ttl ...
Would upload to gs://saved-fisdat/strathclyde/20240730/22464600-4e62-11ef-ad7c-f218987e77f1/sentinel_cages_sampling.converted.ttl ...
Would upload to gs://saved-fisdat/strathclyde/20240730/22464600-4e62-11ef-ad7c-f218987e77f1/sentinel_cages_sampling.converted.ttl ...
Would upload to gs://saved-fisdat/strathclyde/20240730/22464600-4e62-11ef-ad7c-f218987e77f1/sentinel_cages_sampling.converted.ttl ...
Would have uploaded your data/job set/bundle to gs://saved-fisdat/strathclyde/20240730/22464600-4e62-11ef-ad7c-f218987e77f1
</code></pre>
</section>
</section>
<section id="specifying-a-job" class="level2">
<h2 class="anchored" data-anchor-id="specifying-a-job">Specifying a job</h2>
<p>The key thing which we’re able to do is specify a job. Currently, we have implemented a job which runs an ODE model for sea lice count accumulation. This expects the following data input:</p>
<ol type="1">
<li>A time series of modelled lice densities</li>
<li>A count of totals found on individual fish, after sampling a cage</li>
</ol>
<p>When specifying the job, the names of columns are linked together with three pieces of information:</p>
<ol type="1">
<li>The name of a table appended to the manifest file</li>
<li>The name of the column of interest in that table</li>
<li>The underlying variable in the data model. This is particularly important as it is used when running the job to identify the column in question.</li>
</ol>
<p>The job descriptions are structured with a very short name/identifier (the <code>atomic_name</code> attribute), job type (currently only “density” and “ignore” are valid), a list of columns which are based on observed/collected data, and a list of columns which are based on modelled/simulated data. There is an optional title/description field as before.</p>
<p>For the density job, specifically, we expect the following information:</p>
<ol type="1">
<li>Job type as <code>density</code>.</li>
<li>Under the list of <em>collected</em> columns/variables/tables to bring into scope, a specification for observed count of lice totals. The underlying variable against which the pipeline pattern-matches is <code>saved:lice_af_total</code>.</li>
<li>Under the list of <em>modelled</em> columns/variables/tables to bring into scope, a specification of a column for a time series and a specification of a column for associated modelled density in that time series. The underlying variables against which the pipeline pattern-matches are <code>saved:time</code> and <code>saved:density</code> respectively.</li>
</ol>
<p>Let’s try adding this to the manifest file:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">atomic_name</span><span class="kw">:</span><span class="at"> job_dens_cage8_a11_dep1</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">job_type</span><span class="kw">:</span><span class="at"> density</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">title</span><span class="kw">:</span><span class="at"> Density job for cage 8, season A11, deployment 1</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">job_scope_collected</span><span class="kw">:</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">column</span><span class="kw">:</span><span class="at"> TOTAL</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">variable</span><span class="kw">:</span><span class="at"> saved:lice_af_total</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">table</span><span class="kw">:</span><span class="at"> deployment_2011-10-26_2011-11-01_cage_8</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">job_scope_modelled</span><span class="kw">:</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">column</span><span class="kw">:</span><span class="at"> time</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">variable</span><span class="kw">:</span><span class="at"> saved:time</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">table</span><span class="kw">:</span><span class="at"> density</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">column</span><span class="kw">:</span><span class="at"> density</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">variable</span><span class="kw">:</span><span class="at"> saved:density</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">table</span><span class="kw">:</span><span class="at"> density</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now, let’s see if it’s at least valid YAML (notwithstanding actually running the job, which is after we upload):</p>
<pre><code>fisup --dry-run test_manifest.yaml</code></pre>
<p>We should see identical results to the last time we ran that command.</p>
<p>Recall that we also added two other data files to the manifest file. These all have the same column naming, since they are derived from the same source file (narrowed down to specific cages/deployments), and are named near-identically, so try adding the above job description, just replacing <code>cage_8</code> with <code>cage_9</code> and <code>cage_10</code> respectively.</p>
</section>
<section id="uploading-the-data-package-with-fisup" class="level2">
<h2 class="anchored" data-anchor-id="uploading-the-data-package-with-fisup">Uploading the data package with <code>fisup</code></h2>
<p>Now that we’ve specified a (hopefully) valid set of jobs, we can upload for real. The <code>fisup</code> program does a couple of things to prepare for uploading:</p>
<ol type="1">
<li>The YAML schema files are converted to RDF/TTL</li>
<li>The manifest file is converted to RDF/TTL (or, if in RDF/TTL format, to YAML)</li>
<li>An ‘index’ file is created which describes the base prefix/target object when loading</li>
</ol>
<p>Target files which are converted have ‘.converted’ prepended to the file extension, so they won’t overwrite current work. Further note that while YAML schema files upon conversion are always overwritten, while the manifest isn’t. You can either use the <code>--force</code> option or just remove files with ‘converted’ in the file names manually if <code>fisup</code> complains.</p>
<pre><code>fisup test_manifest.yaml</code></pre>
<p>Finally, upon uploading for real, we see output like the following:</p>
<pre><code>This is fisup version 0.7, commit a70efdba00aaff8dce42f0a698b8f1af572a5b3f
Target file test_manifest.converted.ttl exists, and force-overwrite (`--force' option) is set, so overwrite
Proceed with loading schema density.yaml
Generating RDF from provided schema
Dumping generated RDF to density.converted.ttl
Successfully dumped generated RDF to density.converted.ttl
Proceed with loading schema sentinel_cages_sampling.yaml
Generating RDF from provided schema
Done generating RDF from provided schema, serialising
Dumping generated RDF to sentinel_cages_sampling.converted.ttl
Successfully dumped generated RDF to sentinel_cages_sampling.converted.ttl
Proceed with loading schema sentinel_cages_sampling.yaml
Generating RDF from provided schema
Done generating RDF from provided schema, serialising
Dumping generated RDF to sentinel_cages_sampling.converted.ttl
Successfully dumped generated RDF to sentinel_cages_sampling.converted.ttl
Proceed with loading schema sentinel_cages_sampling.yaml
Generating RDF from provided schema
Done generating RDF from provided schema, serialising
Dumping generated RDF to sentinel_cages_sampling.converted.ttl
Successfully dumped generated RDF to sentinel_cages_sampling.converted.ttl
Successfully converted all schemata from YAML to TTL
-------------------------------------------------------------------------------------------
| data URI                                     | data schema                  | data hash |
-------------------------------------------------------------------------------------------
| density.csv                                  | density.yaml                 | 1974c2dbe |
| deployment_2011-10-26_2011-11-01_cage_8.csv  | sentinel_cages_sampling.yaml | 0b93c10c8 |
| deployment_2011-10-26_2011-11-01_cage_9.csv  | sentinel_cages_sampling.yaml | 893615354 |
| deployment_2011-10-26_2011-11-01_cage_10.csv | sentinel_cages_sampling.yaml | 5b7548162 |
-------------------------------------------------------------------------------------------
Uploading gs://saved-rap-test/strathclyde/20240730/538ad90c-4e66-11ef-a43e-f218987e77f1/test_manifest.yaml ...
Uploaded test_manifest.yaml in 0.28s
Uploading gs://saved-rap-test/strathclyde/20240730/538ad90c-4e66-11ef-a43e-f218987e77f1/test_manifest.converted.ttl ...
Uploaded test_manifest.converted.ttl in 0.09s
Uploading gs://saved-rap-test/strathclyde/20240730/538ad90c-4e66-11ef-a43e-f218987e77f1/.index ...
Uploaded .index in 0.09s
Uploading gs://saved-rap-test/strathclyde/20240730/538ad90c-4e66-11ef-a43e-f218987e77f1/density.csv ...
Uploaded density.csv in 0.09s
Uploading gs://saved-rap-test/strathclyde/20240730/538ad90c-4e66-11ef-a43e-f218987e77f1/deployment_2011-10-26_2011-11-01_cage_8.csv ...
Uploaded deployment_2011-10-26_2011-11-01_cage_8.csv in 0.09s
Uploading gs://saved-rap-test/strathclyde/20240730/538ad90c-4e66-11ef-a43e-f218987e77f1/deployment_2011-10-26_2011-11-01_cage_9.csv ...
Uploaded deployment_2011-10-26_2011-11-01_cage_9.csv in 0.08s
Uploading gs://saved-rap-test/strathclyde/20240730/538ad90c-4e66-11ef-a43e-f218987e77f1/deployment_2011-10-26_2011-11-01_cage_10.csv ...
Uploaded deployment_2011-10-26_2011-11-01_cage_10.csv in 0.08s
Uploading gs://saved-rap-test/strathclyde/20240730/538ad90c-4e66-11ef-a43e-f218987e77f1/density.yaml ...
Uploaded density.yaml in 0.08s
Uploading gs://saved-rap-test/strathclyde/20240730/538ad90c-4e66-11ef-a43e-f218987e77f1/sentinel_cages_sampling.yaml ...
Uploaded sentinel_cages_sampling.yaml in 0.08s
Uploading gs://saved-rap-test/strathclyde/20240730/538ad90c-4e66-11ef-a43e-f218987e77f1/sentinel_cages_sampling.yaml ...
Uploaded sentinel_cages_sampling.yaml in 0.16s
Uploading gs://saved-rap-test/strathclyde/20240730/538ad90c-4e66-11ef-a43e-f218987e77f1/sentinel_cages_sampling.yaml ...
Uploaded sentinel_cages_sampling.yaml in 0.09s
Uploading gs://saved-rap-test/strathclyde/20240730/538ad90c-4e66-11ef-a43e-f218987e77f1/density.converted.ttl ...
Uploaded density.converted.ttl in 0.09s
Uploading gs://saved-rap-test/strathclyde/20240730/538ad90c-4e66-11ef-a43e-f218987e77f1/sentinel_cages_sampling.converted.ttl ...
Uploaded sentinel_cages_sampling.converted.ttl in 0.1s
Uploading gs://saved-rap-test/strathclyde/20240730/538ad90c-4e66-11ef-a43e-f218987e77f1/sentinel_cages_sampling.converted.ttl ...
Uploaded sentinel_cages_sampling.converted.ttl in 0.11s
Uploading gs://saved-rap-test/strathclyde/20240730/538ad90c-4e66-11ef-a43e-f218987e77f1/sentinel_cages_sampling.converted.ttl ...
Uploaded sentinel_cages_sampling.converted.ttl in 0.09s
Successfully uploaded your data/job set/bundle to gs://saved-rap-test/strathclyde/20240730/538ad90c-4e66-11ef-a43e-f218987e77f1
Result should, within the next 5-10 minutes, appear at https://rap.tardis.ac/saved/rap/538ad90c-4e66-11ef-a43e-f218987e77f1/</code></pre>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/marine\.gov\.scot\/metadata\/saved\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../doc/utils/manifest.html" class="pagination-link" aria-label="The manifest">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">The manifest</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../doc/utils/debugging.html" class="pagination-link" aria-label="Debugging and troubleshooting">
        <span class="nav-page-text">Debugging and troubleshooting</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/saved-models/data-model/issues/new/choose" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>